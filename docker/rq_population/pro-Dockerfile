FROM alpine

COPY ./wheels/ /wheels/

COPY ./pro.py /settings/pro.py

RUN apk update && \
    apk add \
        --no-cache \
        libpq \
        python3 && \
    pyvenv /venv/rq && \
    source /venv/rq/bin/activate && \
    pip install \
        --no-cache-dir \
        --upgrade pip && \
    pip install \
        --no-cache-dir \
        --find-links /wheels \
        rq_population && \
    rm -rf /wheels

WORKDIR /api

CMD ["/venv/rq/bin/population"]
