version: '2'
volumes:
    git: {}
    log: {}
    sql: {}
    
services:
    web:
      extends:
        service: common_env_pro
        file: ../common-python-service-environment.pro.yml
      expose:
       - "5000"
      environment:
          SETTINGS: ".web.pro"
      image: rebase/pro-web

    cache:
      extends:
        service: common_env_pro
        file: ../common-python-service-environment.pro.yml
      expose:
       - "5000"
      image: rebase/pro-web
      command: ["/venv/web/bin/cache"]

    app:
      image: rebase/client
      environment:
          REBASE_CLIENT_HOST: "dev"
          REBASE_CLIENT_PORT: 3000
      ports:
       - "3000:3000"
      volumes:
       - ../../../react-app:/code
      extends:
        service: common_env
        file: ../api-dev.yml

    code2resume:
        image: rebase/client
        environment:
          REBASE_CLIENT_HOST: "dev"
          REBASE_CLIENT_PORT: 3001
        ports:
         - "3001:3001"
        volumes:
         - ../../../react-app:/code
        extends:
          service: common_env
          file: ../api-dev.yml
        command: ["/code/start", "code2resume"]

    javascript:
        image: rebase/javascript
        expose:
            - "7777"

    parser:
        image: rebase/pro-parser
        expose:
            - "1111"

    rq_git:
      extends:
        service: common_env_pro
        file: ../common-python-service-environment.pro.yml
      image: rebase/pro-rq-git
      ports:
       - "2222:22"
      volumes:
       - git:/git

    rq_default:
      extends:
        service: common_env_pro
        file: ../common-python-service-environment.pro.yml
      image: rebase/pro-rq-default
      environment:
        SETTINGS: ".rq_default.pro"
        CRAWLER_USERNAME:
        CRAWLER_PASSWORD:
      tmpfs:
       - /repos:rw,noexec,size=3g

    rq_population:
      extends:
        service: common_env_pro
        file: ../common-python-service-environment.pro.yml
      image: rebase/pro-rq-population
      environment:
        SETTINGS: ".population.pro"

    jupyter:
      extends:
        service: common_env_pro
        file: ../common-python-service-environment.pro.yml
      image: rebase/jupyter
      ports:
       - "8888:8888"

    rq_dashboard:
        image: rebase/rq_dashboard
        ports:
         - "4444:4444"

    redis:
      image: redis
      restart: always

    database:
      image: postgres
      environment:
        PGDATA: "/var/lib/postgresql/data/rebase"
      volumes:
       - sql:/var/lib/postgresql/data/rebase

    rsyslog:
      image: rebase/rsyslog
      volumes:
       - log:/var/log
